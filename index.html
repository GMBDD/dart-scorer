 <!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Darts Scoring</title>

<style>
:root{
  --bg:#0f0f12; --card:#17171c; --text:#f2f2f2; --muted:#a7a7b0; --line:#2a2a33;
  --btn:#121218; --btn2:#1c1c24;
}
*{box-sizing:border-box}
body{font-family:Arial,sans-serif;background:var(--bg);color:var(--text);margin:0;text-align:center}
header{
  padding:12px;border-bottom:1px solid var(--line);
  display:flex;justify-content:center;flex-wrap:wrap;gap:10px;align-items:center
}
button,select,input{
  padding:10px 14px;font-size:16px;border-radius:12px;border:1px solid var(--line);
  background:var(--btn);color:var(--text);cursor:pointer
}
.wrap{max-width:1100px;margin:0 auto;padding:14px}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:12px}
.card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:12px}
.active{outline:2px solid #3a3a44}
.score{font-size:40px;font-weight:800;margin:10px 0}
.dartRow{display:flex;gap:8px;justify-content:center;margin:8px 0}
.dartBox{min-width:70px;padding:8px;border:1px solid var(--line);border-radius:10px}
.pad{margin-top:10px;border-top:1px solid var(--line);padding-top:10px}
.nums{display:grid;gap:8px;grid-template-columns:repeat(5,1fr);max-width:420px;margin:0 auto}
.specials{display:flex;gap:8px;justify-content:center;margin-top:8px}
.actions{display:flex;gap:8px;justify-content:center;margin-top:8px}
.hint{font-size:12px;color:var(--muted);margin-top:6px}
</style>
</head>

<body>

<header>
<strong>ðŸŽ¯ Darts Scoring</strong>

<span>Spiel:</span>
<select id="gameMode">
<option value="301">301</option>
<option value="501" selected>501</option>
<option value="701">701</option>
<option value="1001">1001</option>
</select>

<span>Spieler:</span>
<select id="playerCount">
<option>1</option><option selected>2</option><option>3</option>
<option>4</option><option>5</option><option>6</option>
</select>

<span>DI:</span>
<select id="doubleIn">
<option value="true">AN</option>
<option value="false" selected>AUS</option>
</select>

<span>Out:</span>
<select id="outMode">
<option value="straight">Straight</option>
<option value="double" selected>Double</option>
<option value="master">Master</option>
</select>

<button id="startBtn">Neues Spiel</button>
<button id="randomBtn">ðŸŽ² Startspieler</button>
<button id="undoBtn">â¬… Undo</button>

</header>

<div class="wrap">
<div id="game" class="grid"></div>
</div>

<script>

let players=[];
let current=0;
let history=[];
let darts=[null,null,null];
let dartIdx=0;
let mode="S";

let startScore=501;
let doubleIn=false;
let outMode="double";

const $=id=>document.getElementById(id);

function saveState(){
history.push(JSON.stringify({
players,current,darts,dartIdx,mode
}));
}

function undo(){
if(!history.length)return;
let s=JSON.parse(history.pop());
players=s.players;
current=s.current;
darts=s.darts;
dartIdx=s.dartIdx;
mode=s.mode;
render();
}

function startGame(){

startScore=parseInt($("gameMode").value);
doubleIn=$("doubleIn").value==="true";
outMode=$("outMode").value;

let count=parseInt($("playerCount").value);

players=[];
for(let i=0;i<count;i++){
players.push({
name:"Spieler "+(i+1),
score:startScore,
opened:!doubleIn,
won:false
});
}

current=0;
history=[];
resetTurn();
render();
}

function randomStart(){
saveState();
current=Math.floor(Math.random()*players.length);
resetTurn();
render();
}

function resetTurn(){
darts=[null,null,null];
dartIdx=0;
mode="S";
}

function nextPlayer(){
current=(current+1)%players.length;
resetTurn();
}

function ensureActive(){
return !players[current].won;
}

function pushDart(obj){
if(!ensureActive())return;
if(dartIdx>2)return;
saveState();
darts[dartIdx]=obj;
dartIdx++;
render();
}

function pickNumber(n){

let pts=n;
let isDouble=false;

if(mode==="D"){pts=n*2;isDouble=true;}
if(mode==="T"){pts=n*3;}

pushDart({
label:mode+n,
points:pts,
isDouble
});
}

function pickBull(){
pushDart({
label:"BULL",
points:50,
isDouble:true
});
}

function pick25(){
pushDart({
label:"25",
points:25,
isDouble:false
});
}

function pickMiss(){
pushDart({
label:"0",
points:0,
isDouble:false
});
}

function submitTurn(){

saveState();

let p=players[current];

let turn=darts.map(d=>d||{points:0,isDouble:false});

if(!p.opened){
let idx=turn.findIndex(d=>d.isDouble);
if(idx===-1){nextPlayer();render();return;}
p.opened=true;
for(let i=0;i<idx;i++)turn[i]={points:0,isDouble:false};
}

let total=turn[0].points+turn[1].points+turn[2].points;
let newScore=p.score-total;

if(newScore<0 || (outMode==="double" && newScore===1)){
nextPlayer();render();return;
}

if(newScore===0){

let last=turn[2];

if(outMode==="double" && !last.isDouble){
nextPlayer();render();return;
}

if(outMode==="master" && !(last.isDouble || last.points%3===0)){
nextPlayer();render();return;
}

p.score=0;
p.won=true;
nextPlayer();
render();
return;
}

p.score=newScore;
nextPlayer();
render();
}

function setMode(m){
mode=m;
render();
}

function render(){

let html="";

players.forEach((p,i)=>{

let active=i===current && !p.won;

html+=`
<div class="card ${active?"active":""}">
<div><b>${p.name}</b></div>
<div class="score">${p.score}</div>

<div class="dartRow">
${renderDart(0,i)}
${renderDart(1,i)}
${renderDart(2,i)}
</div>

<div class="pad">

<div class="actions">
<button onclick="setMode('S')" ${!active?"disabled":""}>Single</button>
<button onclick="setMode('D')" ${!active?"disabled":""}>Double</button>
<button onclick="setMode('T')" ${!active?"disabled":""}>Triple</button>
</div>

<div class="nums">
${[...Array(20)].map((_,k)=>`<button onclick="pickNumber(${k+1})" ${!active?"disabled":""}>${k+1}</button>`).join("")}
</div>

<div class="specials">
<button onclick="pick25()" ${!active?"disabled":""}>25</button>
<button onclick="pickBull()" ${!active?"disabled":""}>BULL</button>
<button onclick="pickMiss()" ${!active?"disabled":""}>MISS</button>
</div>

<div class="actions">
<button onclick="submitTurn()" ${!active?"disabled":""}>OK</button>
</div>

</div>
</div>
`;

});

$("game").innerHTML=html;
}

function renderDart(idx,playerIndex){
if(playerIndex!==current)return `<div class="dartBox">â€”</div>`;
let d=darts[idx];
if(!d)return `<div class="dartBox">â€”</div>`;
return `<div class="dartBox">${d.label}<br>${d.points}</div>`;
}

$("startBtn").onclick=startGame;
$("randomBtn").onclick=randomStart;
$("undoBtn").onclick=undo;

startGame();

</script>

</body>
</html>
